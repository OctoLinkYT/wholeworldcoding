<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>John Learns to Walk</title>
  <style>
    body {
      background: #0d0d0d;
      color: #f0f0f0;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    canvas {
      background: #1a1a1a;
      display: block;
      margin: 20px auto;
      border: 2px solid #333;
      box-shadow: 0 0 20px #0ff;
    }
  </style>
</head>
<body>
  <h1>ðŸ¦´ John the Skeleton Learns to Walk</h1>
  <canvas id="game" width="800" height="400"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");const GROUND_Y = 350;

class Env {
  constructor() {
    this.reset();
  }

  reset() {
    this.john = {
      head: { x: 100, y: 200 },
      torso: { x: 100, y: 250 },
      leftLeg: { x: 90, y: 310 },
      rightLeg: { x: 110, y: 310 },
      velocityX: 0,
      velocityY: 0,
      reward: 0,
      fallen: false,
    };
    this.steps = 0;
    this.done = false;
    this.treat = { x: 600, y: GROUND_Y - 20, w: 15, h: 15 };
    return this.getState();
  }

  getState() {
    const j = this.john;
    return tf.tensor2d([[j.head.x / 800, j.torso.y / 400, j.velocityX / 10]]);
  }

  step(action) {
    const j = this.john;
    // Action: 0 = lean left, 1 = lean right, 2 = jump
    if (action === 0) j.velocityX -= 1;
    if (action === 1) j.velocityX += 1;
    if (action === 2 && j.torso.y >= GROUND_Y - 100) j.velocityY = -5;

    j.head.x += j.velocityX * 0.3;
    j.torso.x = j.head.x;
    j.leftLeg.x = j.head.x - 10;
    j.rightLeg.x = j.head.x + 10;

    j.velocityY += 0.2;
    j.torso.y += j.velocityY;
    j.head.y = j.torso.y - 50;
    j.leftLeg.y = j.torso.y + 50;
    j.rightLeg.y = j.torso.y + 50;

    if (j.torso.y > GROUND_Y) {
      j.torso.y = GROUND_Y;
      j.velocityY = 0;
    }

    let reward = -0.001;

    // Check fall over
    if (j.head.y > j.torso.y + 10 || Math.abs(j.velocityX) > 5) {
      j.fallen = true;
      reward -= 1;
      this.reset();
    }

    // Check if reached treat
    if (
      j.torso.x + 10 > this.treat.x &&
      j.torso.x < this.treat.x + this.treat.w &&
      j.torso.y + 10 > this.treat.y
    ) {
      reward += 2;
      this.treat.x = Math.random() * 600 + 100;
    }

    this.steps++;
    if (this.steps > 1000) this.done = true;
    return { state: this.getState(), reward, done: this.done };
  }

  render() {
    const j = this.john;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Ground
    ctx.fillStyle = "#333";
    ctx.fillRect(0, GROUND_Y, canvas.width, 50);

    // Treat
    ctx.fillStyle = "gold";
    ctx.fillRect(this.treat.x, this.treat.y, this.treat.w, this.treat.h);

    // Skeleton
    ctx.strokeStyle = "#4af";
    ctx.lineWidth = 3;

    ctx.beginPath();
    ctx.moveTo(j.head.x, j.head.y);
    ctx.lineTo(j.torso.x, j.torso.y);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(j.torso.x, j.torso.y);
    ctx.lineTo(j.leftLeg.x, j.leftLeg.y);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(j.torso.x, j.torso.y);
    ctx.lineTo(j.rightLeg.x, j.rightLeg.y);
    ctx.stroke();

    // Head
    ctx.fillStyle = "#4af";
    ctx.beginPath();
    ctx.arc(j.head.x, j.head.y, 10, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#fff";
    ctx.font = "10px monospace";
    ctx.fillText("John", j.head.x - 10, j.head.y - 12);
  }
}

const env = new Env();

async function runRandom() {
  while (true) {
    const action = Math.floor(Math.random() * 3);
    env.step(action);
    env.render();
    await tf.nextFrame();
  }
}

runRandom();

  </script>
</body>
</html>