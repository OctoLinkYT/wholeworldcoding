<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>John Learns to Navigate Pipes</title>
  <style>
    body { background: #111; color: #fff; font-family: monospace; text-align: center; margin: 0; }
    canvas { background: #222; display: block; margin: 1em auto; border: 2px solid #555; }
    #goals { max-width: 600px; margin: 1em auto; background: #000; padding: 10px; border: 1px solid #333; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>John Jumps Like Flappy!</h1>
  <canvas id="game" width="600" height="300"></canvas>
  <div id="goals">
    <h3>Goal Tracker</h3>
    <ul id="goalList"><li>Pass through the gaps, avoid pipes, grab food!</li></ul>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const goalList = document.getElementById("goalList");
    function addGoal(goal) {
      const li = document.createElement("li");
      li.textContent = goal;
      goalList.appendChild(li);
    }

    class Pipe {
      constructor(x) {
        this.x = x;
        this.width = 40;
        this.gapY = 80 + Math.random() * 100;
        this.gapHeight = 80;
      }

      update() {
        this.x -= 2;
      }

      draw() {
        ctx.fillStyle = "#4a4";
        // top pipe
        ctx.fillRect(this.x, 0, this.width, this.gapY);
        // bottom pipe
        ctx.fillRect(this.x, this.gapY + this.gapHeight, this.width, canvas.height - this.gapY - this.gapHeight);
      }

      collides(player) {
        return (
          player.x + player.w > this.x && player.x < this.x + this.width &&
          (player.y < this.gapY || player.y + player.h > this.gapY + this.gapHeight)
        );
      }

      passed(player) {
        return this.x + this.width < player.x && !this.scored;
      }
    }

    class Game {
      constructor() {
        this.reset();
      }

      reset() {
        this.x = 50;
        this.y = 150;
        this.vy = 0;
        this.gravity = 0.5;
        this.jumpPower = -7;
        this.w = 30;
        this.h = 30;
        this.health = 100;
        this.score = 0;

        this.pipes = [];
        this.pipeTimer = 0;

        this.foods = [];
        this.foodCollected = 0;
      }

      jump() {
        this.vy = this.jumpPower;
      }

      update() {
        this.vy += this.gravity;
        this.y += this.vy;

        // Add new pipes
        this.pipeTimer++;
        if (this.pipeTimer > 90) {
          this.pipes.push(new Pipe(canvas.width));
          this.pipeTimer = 0;
        }

        // Update pipes
        for (let pipe of this.pipes) {
          pipe.update();
          if (pipe.collides(this)) {
            this.health -= 20;
          }
          if (pipe.passed(this)) {
            this.score++;
            pipe.scored = true;
            this.foods.push({ x: pipe.x + 20, y: pipe.gapY + pipe.gapHeight / 2 - 7, collected: false });
            addGoal("Grabbed a snack after pipe!");
          }
        }

        // Remove old pipes
        this.pipes = this.pipes.filter(p => p.x + p.width > 0);

        // Food collection
        for (let food of this.foods) {
          if (!food.collected &&
              this.x < food.x + 10 &&
              this.x + this.w > food.x &&
              this.y < food.y + 10 &&
              this.y + this.h > food.y) {
            food.collected = true;
            this.foodCollected++;
            addGoal("Yum! Food collected.");
          }
        }

        // Dying
        if (this.y > canvas.height || this.y < 0 || this.health <= 0) {
          this.explode();
          this.reset();
        }
      }

      explode() {
        for (let i = 0; i < 20; i++) {
          ctx.fillStyle = "red";
          ctx.fillRect(this.x + Math.random() * 30 - 15, this.y + Math.random() * 30 - 15, 4, 4);
        }
      }

      draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Pipes
        for (let pipe of this.pipes) {
          pipe.draw();
        }

        // Foods
        for (let food of this.foods) {
          if (!food.collected) {
            ctx.fillStyle = "gold";
            ctx.fillRect(food.x, food.y, 10, 10);
          }
        }

        // John
        ctx.fillStyle = "#4af";
        ctx.fillRect(this.x, this.y, this.w, this.h);

        // Eyes
        ctx.fillStyle = "#fff";
        ctx.fillRect(this.x + 5, this.y + 8, 5, 5);
        ctx.fillRect(this.x + 20, this.y + 8, 5, 5);

        // Health bar
        ctx.fillStyle = "#fff";
        ctx.fillText("Health", 10, 10);
        ctx.fillStyle = "green";
        ctx.fillRect(60, 2, (this.health / 100) * 100, 8);
        ctx.strokeStyle = "#fff";
        ctx.strokeRect(60, 2, 100, 8);

        // Score
        ctx.fillText("Score: " + this.score, canvas.width - 80, 10);
      }
    }

    const game = new Game();

    function loop() {
      game.update();
      game.draw();
      requestAnimationFrame(loop);
    }

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        game.jump();
      }
    });

    loop();
  </script>
</body>
</html>