<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sign In/Register</title>
  <style>
    :root {
      --bg-light: #f9f9f9;
      --bg-dark: #121212;
      --text-light: #111;
      --text-dark: #fff;
      --accent: #a855f7;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      transition: background 0.3s, color 0.3s;
    }

    .background {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
    }

    .shape {
      position: absolute;
      border-radius: 50%;
      opacity: 0.2;
    }

    .shape1 { width: 300px; height: 300px; background: #f43f5e; top: -100px; left: -100px; }
    .shape2 { width: 200px; height: 200px; background: #3b82f6; bottom: -50px; right: -50px; }
    .shape3 { width: 150px; height: 150px; background: #22c55e; top: 50%; left: 60%; transform: translate(-50%, -50%); }

    .container {
      max-width: 420px;
      margin: 8vh auto;
      padding: 2rem 2.5rem;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.9);
      color: var(--text-light);
      box-shadow: 0 0 24px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    body.dark .container {
      background: rgba(18, 18, 18, 0.95);
      color: var(--text-dark);
    }

    h1 {
      text-align: center;
      color: var(--accent);
      margin-bottom: 1rem;
      width: 100%;
    }

    input, button {
      width: 100%;
      max-width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      border-radius: 8px;
      font-size: 1rem;
      border: none;
      transition: 0.2s;
      box-sizing: border-box;
      display: block;
    }

    input {
      background: #eee;
      text-align: left;
    }

    body.dark input {
      background: #222;
      color: white;
    }

    button {
      background: var(--accent);
      color: white;
      cursor: pointer;
      font-weight: 600;
    }

    button:hover {
      background: #9333ea;
    }

    .oauth-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: #fff;
      border: 1px solid #ccc;
      color: #111;
      font-weight: 500;
      margin-top: 1rem;
      max-width: 100%;
      cursor: pointer;
      user-select: none;
    }

    .oauth-btn:hover {
      background: #f0f0f0;
    }

    .oauth-btn svg {
      width: 20px;
      height: 20px;
    }

    .link {
      text-align: center;
      margin-top: 1rem;
      width: 100%;
    }

    .link a {
      cursor: pointer;
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }
    .link a:hover {
      text-decoration: underline;
    }

    .theme-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
      cursor: pointer;
      font-size: 0.9rem;
      background: transparent;
      border: none;
      color: var(--accent);
    }

    footer {
      margin-top: 2rem;
      text-align: center;
      font-size: 0.85rem;
      opacity: 0.6;
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="background">
    <div class="shape shape1"></div>
    <div class="shape shape2"></div>
    <div class="shape shape3"></div>
  </div>

  <div class="container">
    <h1 id="formTitle">Sign In</h1>

    <input id="email" type="email" placeholder="Email" autocomplete="username" />
    <input id="password" type="password" placeholder="Password" autocomplete="current-password" />
    <button id="mainBtn">Sign In</button>

    <div class="link" id="toggleText">
      Don't have an account? <a id="toggleLink">Register</a>
    </div>

    <hr style="margin: 2rem 0; border: none; border-top: 1px solid #ccc; width: 100%; max-width: 420px;">

    <button class="oauth-btn" id="googleBtn" aria-label="Sign in with Google">
      <svg viewBox="0 0 533.5 544.3"><path fill="#4285f4" d="M533.5 278.4c0-17.3-1.5-34-4.3-50.3H272v95.2h146.9c-6.4 34.6-25.2 63.8-53.8 83.4v68.9h86.9c50.7-46.7 81.5-115.4 81.5-197.2z"/><path fill="#34a853" d="M272 544.3c72.6 0 133.6-24 178.2-65.2l-86.9-68.9c-24.1 16.2-55 25.9-91.3 25.9-70 0-129.3-47.2-150.5-110.4h-89v69.6c44.8 88.4 136.6 149 239.5 149z"/><path fill="#fbbc04" d="M121.5 325.7c-10.3-30.4-10.3-63.3 0-93.7v-69.6h-89c-38.6 76.9-38.6 165.9 0 242.8l89-69.5z"/><path fill="#ea4335" d="M272 107.7c39.4-.6 77.4 13.8 106.6 40.1l79.6-79.6c-50.7-47.4-117.4-73.4-186.2-73.1-102.9 0-194.7 60.6-239.5 149l89 69.6c21.3-63.3 80.5-110.6 150.5-110.6z"/></svg>
      Sign in with Google
    </button>

    <button class="oauth-btn" id="githubBtn" aria-label="Sign in with GitHub">
      <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.38 0 0 5.38 0 12a12 12 0 008.21 11.44c.6.11.82-.26.82-.58v-2.23c-3.34.73-4.04-1.6-4.04-1.6-.55-1.4-1.35-1.78-1.35-1.78-1.1-.75.08-.74.08-.74 1.22.09 1.86 1.25 1.86 1.25 1.08 1.85 2.83 1.32 3.52 1 .11-.78.42-1.32.76-1.62-2.67-.3-5.47-1.34-5.47-5.97 0-1.32.47-2.4 1.24-3.24-.12-.3-.54-1.51.12-3.14 0 0 1.01-.32 3.3 1.23a11.4 11.4 0 016 0c2.29-1.55 3.3-1.23 3.3-1.23.66 1.63.24 2.84.12 3.14.77.84 1.23 1.92 1.23 3.24 0 4.64-2.81 5.67-5.49 5.96.43.37.81 1.1.81 2.22v3.3c0 .32.21.69.82.58A12 12 0 0024 12c0-6.62-5.38-12-12-12z"/></svg>
      Sign in with GitHub
    </button>

    <footer>
      [wholeworldcoding]
    </footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getAuth,
      signInWithPopup,
      GoogleAuthProvider,
      GithubAuthProvider,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

    const config = {
      apiKey: "AIzaSyDiR4FTXOuS-IvEu0GeOnDpOYL2t3I2OSQ",
      authDomain: "wholewrldcoding.firebaseapp.com",
      projectId: "wholewrldcoding",
      storageBucket: "wholewrldcoding.firebasestorage.app",
      messagingSenderId: "655030339964",
      appId: "1:655030339964:web:9f37974e88fbdbf81b7cf9",
      measurementId: "G-7TC98Q6H2E"
    };

    const app = initializeApp(config);
    const auth = getAuth(app);
    const returnUrl = new URLSearchParams(location.search).get("return") || "/";

    // Track mode: signIn or register
    let mode = "signIn";

    const formTitle = document.getElementById("formTitle");
    const mainBtn = document.getElementById("mainBtn");
    const toggleText = document.getElementById("toggleText");
    const toggleLink = document.getElementById("toggleLink");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");

    async function storeAndRedirect(user) {
      const token = await user.getIdToken();
      const data = {
        name: user.displayName,
        email: user.email,
        uid: user.uid,
        provider: user.providerData[0]?.providerId || "unknown",
        token: token
      };
      localStorage.setItem("wwc-auth", JSON.stringify(data));
      location.href = returnUrl;
    }

    function switchMode() {
      if (mode === "signIn") {
        mode = "register";
        formTitle.textContent = "Register";
        mainBtn.textContent = "Register";
        toggleText.innerHTML = 'Already have an account? <a id="toggleLink">Sign In</a>';
      } else {
        mode = "signIn";
        formTitle.textContent = "Sign In";
        mainBtn.textContent = "Sign In";
        toggleText.innerHTML = 'Don\'t have an account? <a id="toggleLink">Register</a>';
      }
      // Re-attach toggle event because innerHTML replacement wipes events
      document.getElementById("toggleLink").onclick = (e) => {
        e.preventDefault();
        switchMode();
      };
      // Clear inputs for fresh start
      emailInput.value = "";
      passwordInput.value = "";
    }

    toggleLink.onclick = (e) => {
      e.preventDefault();
      switchMode();
    };

    mainBtn.onclick = () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      if (!email || !password) {
        alert("Please enter both email and password.");
        return;
      }

      if (mode === "signIn") {
        signInWithEmailAndPassword(auth, email, password)
          .then(res => storeAndRedirect(res.user))
          .catch(err => alert(err.message));
      } else {
        createUserWithEmailAndPassword(auth, email, password)
          .then(res => storeAndRedirect(res.user))
          .catch(err => alert(err.message));
      }
    };

    document.getElementById("googleBtn").onclick = () => {
      signInWithPopup(auth, new GoogleAuthProvider())
        .then(res => storeAndRedirect(res.user))
        .catch(err => alert(err.message));
    };

    document.getElementById("githubBtn").onclick = () => {
      signInWithPopup(auth, new GithubAuthProvider())
        .then(res => storeAndRedirect(res.user))
        .catch(err => alert(err.message));
    };
  </script>

</body>
</html>
